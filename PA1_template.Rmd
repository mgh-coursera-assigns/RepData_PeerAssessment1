---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---



```{r dependencies}
require("stringr")
require("knitr")
require("ggplot2")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE)
```
## Loading and preprocessing the data

Loading data from the file into a data frame, stopping the script
if data frame could not be created.

```{r loaddata}
##
##  Loads into a dataframe from a CSV file.
##    If specified by 'unzip', the function assumes 'localFile' is a 
##    zip archive and extracts its contents into 'unzipDestDir' or the 
##    current working directory if 'unzipDestDir' is empty or NULL.
##    This function assumes that the zip file contains a single CSV file.
##
readLocalCSVFile <- function(localFile, unzip = FALSE, unzipDestDir = NULL) {

      if( !file.exists(localFile)) {
            stop(paste0("File \'", 
                        localFile, 
                        "\'. Check permissions and access privileges if the file actually exists."));
      }
      
      retVal = localFile;
      if (unzip) { 
            if (is.null(unzipDestDir) || nchar(unzipDestDir) == 0) {
                  unzipDestDir <- getwd();  
            }
            
            unzipDestDir <- str_trim(unzipDestDir);
            
            if (!file.exists(unzipDestDir) 
               && !file.create(unzipDestDir)) {
                  stop(paste0("Unable to create unzip destination directory \'", 
                              unzipDestDir, "\'"));
            }
            
            retVal = unzip(localFile, exdir = unzipDestDir);
      }  
      
      if (!is.null(retVal)) {
            retVal <- read.csv(retVal, header = TRUE, colClasses = c(steps="integer", date="character", interval="integer"), stringsAsFactors = TRUE)
      }
      
      retVal
} ## readLocalCSVFile(..)

## Load the into 'dataset'
try(dataset <- readLocalCSVFile("activity.zip", unzip = TRUE), silent = TRUE)

dataset$date <- factor(dataset$date)
```

## What is mean total number of steps taken per day?
```{r meanSteps, echo=FALSE, results = FALSE} 

factoredData <- split(dataset, dataset$date)

df_DailySteps <- data.frame(date = character(length(factoredData)), 
                            steps = integer(length(factoredData)), 
                            stringsAsFactors = FALSE)
iter <- 0
for (day in factoredData) {
      dayssum <- sum(day$steps, na.rm = TRUE);
      iter <- iter + 1
      df_DailySteps$date[iter] <- as.character(day$date[1])
      df_DailySteps$steps[iter] <- as.numeric(dayssum)
}

```

```{r meanAndMedianTotalSteps, echo = FALSE, results = FALSE}
options(scipen = 6)
meanTotalDailySteps <- mean(as.numeric(df_DailySteps$steps), na.rm = TRUE)

medianTotalDailySteps <- median(as.numeric(df_DailySteps$steps), na.rm = TRUE)
```

Mean of total number of daily steps: `r round(meanTotalDailySteps, 3)`

Median of total number of daily steps: `r medianTotalDailySteps`

##Total number of steps taken each day 
```{r tblTotalDailySteps, echo = FALSE, results = FALSE}
require("ggplot2")

##qplot(df_DailySteps$date, geom = "histogram", binwidth = 0.5, xlab = "Day", col = I("red"), main = "Histogram")
p <- ggplot(data = df_DailySteps, aes(x = date))
p <- p + geom_bar(aes(y = steps), stat = "identity", alpha = 1, width = 0.6, position = position_dodge(width = 1.9))
p <- p + theme(axis.text.x = element_text(angle = 90))
p <- p + xlab("Dates") + ylab("Total Steps") + ggtitle("Daily Total Steps")
print(p)
```

## What is the average daily activity pattern?
```{r avgDailyPattern, echo = FALSE}
factIntvlData <- split(dataset, dataset$interval)
df_IntvlSteps <- data.frame(interval = integer(length(factIntvlData)), steps = integer(length(factIntvlData)), stringsAsFactors = FALSE)

iter <- 0
for (intvl in factIntvlData) {
      avgIntvl <- mean(intvl$steps, na.rm = TRUE);
      ##totalTimeEachDay <- append(totalTimeEachDay, sumDay)
      ##newR <- c(as.character(day$date[1]), as.numeric(sumDay))
      iter <- iter + 1
      df_IntvlSteps$interval[iter] <- as.numeric(intvl$interval[1])
      df_IntvlSteps$steps[iter] <- as.numeric(avgIntvl)

      ##print(paste0("sumDay = ", sumDay))
}

plot(seq(1, length(df_IntvlSteps$interval)), df_IntvlSteps$steps, type="l", main="Average Steps by Interval", xlab = "Interval", ylab = "Avg. Steps", xaxt='n')
seqXTicks <- seq(0, length(df_IntvlSteps$interval), by = 4)
axis(side = 1, at = seqXTicks)
intvlWithMaxSteps <- df_IntvlSteps[which.max(df_IntvlSteps$steps), ]$interval
maxAvgStepsInIntvl <- max(df_IntvlSteps$steps)
clockTimeAtIntvl <- paste0(intvlWithMaxSteps %/% 60, ":", intvlWithMaxSteps %% 60, " hours")
```


Interval # `r intvlWithMaxSteps`, viz. `r clockTimeAtIntvl`, has the highest average steps taken among the intervals measured, with an average of `r round(maxAvgStepsInIntvl, 3)` steps.

## Imputing missing values


## Are there differences in activity patterns between weekdays and weekends?
